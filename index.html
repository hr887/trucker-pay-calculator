<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Truck Driver Pay Calculator</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.9.2/dist/confetti.browser.min.js"></script>

    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f0f2f5;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }
        .bg-pattern {
            background-image: radial-gradient(#dbeafe 1px, transparent 1px);
            background-size: 16px 16px;
        }
        .view { transition: opacity 0.3s ease-in-out, transform 0.3s ease-in-out; width: 100%; }
        .view-container { position: relative; min-height: 450px; }
        .view.hidden { opacity: 0; transform: scale(0.98); pointer-events: none; position: absolute; top: 0; left: 0; }
        .btn { transition: all 0.2s ease-in-out; border-radius: 0.5rem; padding-top: 0.875rem; padding-bottom: 0.875rem; font-weight: 600; box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px 0 rgba(0, 0, 0, 0.06); }
        .btn:hover { transform: translateY(-2px); box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06); }
        .btn-primary { background-color: #2c3e50; color: white; }
        .btn-primary:hover { background-color: #34495e; }
        .btn-action { background-color: #1abc9c; color: white; }
        .btn-action:hover { background-color: #1dd2af; }
        .progress-bar-bg { background-color: #e0e0e0; border-radius: 9999px; overflow: hidden; }
        .progress-bar-fill { background-color: #1abc9c; transition: width 0.5s ease-in-out; }
        .lang-btn { font-size: 0.875rem; font-weight: 500; padding: 0.5rem 1rem; border-radius: 0.375rem; transition: background-color 0.2s, color 0.2s; text-align: left; width: 100%; }
        .lang-btn.active { background-color: #1abc9c; color: white; }
        .btn-cta {
            background-color: #ef4444; /* Tailwind's red-500 */
            color: white;
            animation: pulse 2s infinite;
        }
        .btn-cta:hover {
            background-color: #dc2626; /* Tailwind's red-600 */
            animation: none; /* Pause animation on hover */
        }
        @keyframes pulse {
            0%, 100% {
                transform: scale(1);
                box-shadow: 0 0 0 0 rgba(239, 68, 68, 0.7);
            }
            50% {
                transform: scale(1.02);
                box-shadow: 0 0 0 10px rgba(239, 68, 68, 0);
            }
        }
    </style>
</head>
<body class="antialiased bg-pattern">

    <div class="min-h-screen w-full flex items-center justify-center p-4">
        <div class="bg-white rounded-2xl shadow-xl w-full max-w-md text-gray-800 relative">
            
            <header class="p-4 sm:p-6 flex justify-between items-center border-b border-gray-200">
                <div class="flex items-center space-x-3">
                    <button id="back-arrow" class="text-gray-400 hover:text-gray-700 transition-colors hidden">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path></svg>
                    </button>
                    <img src="https://i.postimg.cc/BvFFBrMk/image.png" alt="Company Logo" class="h-10 w-auto">
                </div>
                <div class="relative">
                    <button id="language-toggle-btn" class="text-sm font-semibold text-gray-500 hover:bg-gray-100 px-3 py-1 border border-gray-300 rounded-full transition-colors">
                        Language
                    </button>
                    <div id="language-dropdown" class="absolute right-0 mt-2 w-32 bg-white rounded-md shadow-lg p-1 z-20 hidden">
                        <button id="lang-en" onclick="setLanguage('en')" class="lang-btn">English</button>
                        <button id="lang-es" onclick="setLanguage('es')" class="lang-btn">Español</button>
                        <button id="lang-ru" onclick="setLanguage('ru')" class="lang-btn">&#1056;&#1091;&#1089;&#1089;&#1082;&#1080;&#1081;</button>
                        <button id="lang-uz" onclick="setLanguage('uz')" class="lang-btn">O'zbek</button>
                    </div>
                </div>
            </header>
            
            <div class="p-6 sm:p-8">
                <div class="text-center mb-6">
                     <p class="text-lg font-semibold text-gray-700" data-key="appTitle">Truck Driver Pay Calculator</p>
                </div>

                <div id="progress-container" class="my-6">
                    <p id="progress-text" class="text-sm font-semibold text-center text-gray-500 mb-2" data-key="progressText">Step 1 of 3: Driver Type</p>
                    <div class="progress-bar-bg h-2 w-full">
                        <div id="progress-bar" class="progress-bar-fill h-2" style="width: 33%;"></div>
                    </div>
                </div>
                
                <div class="view-container">
                       <div id="view-question1" class="view">
                           <div class="text-center mb-6 p-3 bg-teal-50 border border-teal-200 rounded-lg">
                               <p class="text-base font-bold text-teal-800" data-key="promoTitle">Earn up to $6000/week with us!</p>
                               <p class="text-sm text-teal-600" data-key="promoSubtitle">Find out your potential take-home pay below.</p>
                           </div>
                           <h2 class="text-xl font-bold text-center mb-4" data-key="question1Title">What type of driver are you?</h2>
                           <div class="space-y-4">
                               <button onclick="trackClickEvent('Selected Lease Operator'); selectDriverType('lease');" class="btn btn-primary w-full" data-key="leaseButton">Lease Operator</button>
                               <button onclick="trackClickEvent('Selected Company Driver'); selectDriverType('company');" class="btn btn-primary w-full" data-key="companyButton">Company Driver</button>
                               <button onclick="trackClickEvent('Selected Owner Operator'); selectDriverType('owner');" class="btn btn-primary w-full" data-key="ownerButton">Owner Operator</button>
                           </div>
                       </div>

                       <div id="view-question2" class="view hidden">
                           <h2 class="text-xl font-bold text-center mb-4" data-key="question2Title">How many miles can you drive in a week?</h2>
                           <div class="space-y-4">
                               <input type="number" id="miles-input" class="w-full text-center text-lg p-3 border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-teal-500 focus:border-teal-500 transition">
                               <button onclick="submitMiles();" class="btn btn-action w-full" data-key="calculateButton">Calculate</button>
                           </div>
                       </div>

                       <div id="view-result" class="view hidden text-center">
                           <h2 class="text-xl font-semibold text-gray-600 mb-2" data-key="resultTitle">Your Potential Take Home Is</h2>
                           <p id="result-amount" class="text-5xl font-extrabold text-gray-900 mb-2">$0.00</p>
                           <div id="result-message" class="p-3 bg-blue-50 border border-blue-200 rounded-lg text-blue-800 text-sm mb-4"></div>
                           
                           <!-- UPDATED: "See Calculation" button is now styled as a link -->
                           <button onclick="trackClickEvent('Clicked See Calculation'); showCalculation();" class="text-sm text-indigo-600 hover:underline font-semibold py-2 mb-4" data-key="seeCalculationLink">See how we calculated this</button>
                           
                           <div class="space-y-3">
                               <button onclick="trackClickEvent('Clicked APPLY NOW'); showView('view-apply');" class="btn btn-cta w-full text-lg" data-key="applyNowButton">APPLY NOW</button>
                               <button onclick="trackClickEvent('Clicked Share Estimate'); shareResult();" class="btn bg-gray-200 hover:bg-gray-300 text-gray-800 w-full flex items-center justify-center space-x-2">
                                  <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20"><path d="M15 8a3 3 0 10-2.977-2.63l-4.94 2.47a3 3 0 100 4.319l4.94 2.47a3 3 0 10.895-1.789l-4.94-2.47a3.027 3.027 0 000-.74l4.94-2.47C13.456 7.68 14.19 8 15 8z"></path></svg>
                                   <span data-key="shareButton">Share Estimate</span>
                               </button>
                               <button onclick="trackClickEvent('Clicked New Calculation'); restart();" class="btn bg-gray-500 hover:bg-gray-600 text-white w-full" data-key="newCalculationButton">Start a New Calculation</button>
                           </div>
                           <div class="mt-8 pt-4 border-t border-gray-200">
                               <p class="text-lg font-semibold text-gray-700 mb-4" data-key="contactUs">Contact Us</p>
                               <div class="mb-4">
                                   <div class="flex justify-center items-center space-x-6">
                                       <a href="tel:+18474079858" onclick="trackClickEvent('Clicked Phone Icon');" class="text-gray-400 hover:text-green-600 transition-colors" title="Call Us">
                                           <svg class="w-7 h-7" fill="currentColor" viewBox="0 0 24 24"><path d="M6.62 10.79c1.44 2.83 3.76 5.14 6.59 6.59l2.2-2.2c.27-.27.67-.36 1.02-.24 1.12.37 2.33.57 3.57.57.55 0 1 .45 1 1V20c0 .55-.45 1-1 1-9.39 0-17-7.61-17-17 0-.55.45-1 1-1h3.5c.55 0 1 .45 1 1 0 1.25.2 2.45.57 3.57.11.35.03.74-.25 1.02l-2.2 2.2z"/></svg>
                                       </a>
                                       <a href="https://t.me/tomr_robins0n" target="_blank" rel="noopener noreferrer" onclick="trackClickEvent('Clicked Telegram Icon');" class="text-gray-400 hover:text-sky-600 transition-colors" title="Telegram">
                                           <img src="https://telegram.org/img/t_logo.png" alt="Telegram Logo" class="w-7 h-7">
                                       </a>
                                   </div>
                                   <a href="mailto:hr@raystarllc.com" onclick="trackClickEvent('Clicked Email Text');" class="block mt-3 text-gray-500 hover:text-indigo-600 transition-colors text-sm font-medium">hr@raystarllc.com</a>
                               </div>
                           </div>
                       </div>

                       <div id="view-apply" class="view hidden">
                           <h2 class="text-xl font-bold text-center mb-4" data-key="applyTitle">Apply Now</h2>
                           <form id="application-form" class="space-y-4">
                               <input name="fullName" type="text" required class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                               <input name="phone" type="tel" required class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                               <input name="email" type="email" required class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                               <button id="submit-form-button" type="submit" class="btn btn-action w-full" data-key="submitApplicationButton">Submit Application</button>
                           </form>
                       </div>
                       
                       <div id="view-thanks" class="view hidden text-center">
                           <h2 class="text-2xl font-bold text-green-600 mb-4" data-key="thanksTitle">Thank You!</h2>
                           <p class="text-gray-600" data-key="thanksSubtitle">Your application has been submitted. We will be in touch shortly.</p>
                           <button onclick="restart();" class="btn btn-primary w-full mt-6" data-key="startOverButton">Start Over</button>
                       </div>
                       
                       <div id="view-calculation" class="view hidden text-left">
                           <h2 class="text-xl font-bold text-center mb-4" data-key="breakdownTitle">Calculation Breakdown</h2>
                           <div id="calculation-details" class="space-y-4 text-sm text-gray-700"></div>
                       </div>
                </div>

                <div class="text-center mt-8 pt-4 border-t border-gray-200">
                    <p class="text-xs text-gray-400" data-key="copyright">&copy; 2025 Ray Star LLC. All Rights Reserved.</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        const scriptURL = 'https://script.google.com/macros/s/AKfycbylfdSVfvAph-Uhngaa43ZL-9E4hZW-bqYWjfa06-VJ7ifRyIjtJwNkTeNr2cRIFaC0Gg/exec';
        
        const translations = {
            en: {
                promoTitle: 'Earn up to $6000/week with us!', appTitle: 'Truck Driver Pay Calculator', progressText: 'Step {step} of 3: {page}', promoSubtitle: 'Find out your potential take-home pay below.', question1Title: 'What type of driver are you?', leaseButton: 'Lease Operator', companyButton: 'Company Driver', ownerButton: 'Owner Operator', question2Title: 'How many miles can you drive in a week?', milesPlaceholder: 'e.g., 2500', calculateButton: 'Calculate', resultTitle: 'Your Potential Take Home Is', resultMsgHigh: '&#127942; Outstanding result! You\'re in the top tier of earners.', resultMsgMid: '&#x2728; Excellent result! This is a strong, competitive income.', resultMsgLow: '&#x1F4C8; A great starting point with solid potential for growth.', seeCalculationLink: 'See how we calculated this', applyNowButton: 'APPLY NOW', shareButton: 'Share Estimate', newCalculationButton: 'Start a New Calculation', applyTitle: 'Apply Now', applySubtitle: 'You\'re one step away! Fill out your info below.', fullNamePlaceholder: 'Full name', phonePlaceholder: 'Phone number', emailPlaceholder: 'Email', submitApplicationButton: 'Submit Application', thanksTitle: 'Thank You!', thanksSubtitle: 'Your application has been submitted. We will be in touch shortly.', startOverButton: 'Start Over', breakdownTitle: 'Calculation Breakdown', copyright: '&copy; 2025 Ray Star LLC. All Rights Reserved.', contactUs: 'Contact Us', companyDriverTitle: 'Company Driver Pay',
                progressStep1: 'Driver Type', progressStep2: 'Weekly Miles', progressStep3: 'Your Results',
                calcGrossIncome: '1. Gross Income', calcMilesDriven: '{miles} miles', calcPerMile: '× ${rate}/mile', calcExpenses: '2. Estimated Expenses', calcFixedCosts: 'Fixed Costs:', calcVariableCosts: 'Variable Costs (for {miles} miles):', calcTotalExpenses: 'Total Estimated Expenses', calcTakeHome: '3. Potential Take-Home', calcIncome: 'Income', calcMinusExpenses: 'Expenses'
            },
            es: {
                promoTitle: '¡Gana hasta $6000/semana con nosotros!', appTitle: 'Calculadora de Pago para Camioneros', progressText: 'Paso {step} de 3: {page}', promoSubtitle: 'Descubre tu pago potencial a continuación.', question1Title: '¿Qué tipo de conductor eres?', leaseButton: 'Operador de Arrendamiento', companyButton: 'Conductor de Compañía', ownerButton: 'Propietario Operador', question2Title: '¿Cuántas millas puedes conducir en una semana?', milesPlaceholder: 'ej., 2500', calculateButton: 'Calcular', resultTitle: 'Tu Pago Potencial Es', resultMsgHigh: '&#127942; ¡Resultado sobresaliente! Estás en el nivel más alto de ingresos.', resultMsgMid: '&#x2728; ¡Excelente resultado! Este es un ingreso fuerte y competitivo.', resultMsgLow: '&#x1F4C8; Un gran punto de partida con un sólido potencial de crecimiento.', seeCalculationLink: 'Ver cómo calculamos esto', applyNowButton: 'APLICAR AHORA', shareButton: 'Compartir Estimación', newCalculationButton: 'Empezar un Nuevo Cálculo', applyTitle: 'Aplicar Ahora', applySubtitle: '¡Estás a un paso! Completa tu información.', fullNamePlaceholder: 'Nombre completo', phonePlaceholder: 'Número de teléfono', emailPlaceholder: 'Correo electrónico', submitApplicationButton: 'Enviar Solicitud', thanksTitle: '¡Gracias!', thanksSubtitle: 'Tu solicitud ha sido enviada. Nos pondremos en contacto pronto.', startOverButton: 'Empezar de Nuevo', breakdownTitle: 'Desglose del Cálculo', copyright: '&copy; 2025 Ray Star LLC. Todos los derechos reservados.', contactUs: 'Contáctanos', companyDriverTitle: 'Pago de Conductor de Compañía',
                progressStep1: 'Tipo de Conductor', progressStep2: 'Millas Semanales', progressStep3: 'Tus Resultados',
                calcGrossIncome: '1. Ingresos Brutos', calcMilesDriven: '{miles} millas', calcPerMile: '× ${rate}/milla', calcExpenses: '2. Gastos Estimados', calcFixedCosts: 'Costos Fijos:', calcVariableCosts: 'Costos Variables (para {miles} millas):', calcTotalExpenses: 'Total de Gastos Estimados', calcTakeHome: '3. Pago Potencial', calcIncome: 'Ingresos', calcMinusExpenses: 'Gastos'
            },
            ru: {
                promoTitle: 'Зарабатывайте до $6000 в неделю с нами!', appTitle: 'Калькулятор Зарплаты Водителя', progressText: 'Шаг {step} из 3: {page}', promoSubtitle: 'Узнайте вашу потенциальную зарплату ниже.', question1Title: 'Какой вы тип водителя?', leaseButton: 'Водитель в лизинге', companyButton: 'Водитель компании', ownerButton: 'Владелец-оператор', question2Title: 'Сколько миль вы проезжаете в неделю?', milesPlaceholder: 'например, 2500', calculateButton: 'Рассчитать', resultTitle: 'Ваш Потенциальный Доход', resultMsgHigh: '&#127942; Выдающийся результат! Вы входите в число самых высокооплачиваемых водителей.', resultMsgMid: '&#x2728; Отличный результат! Это сильный, конкурентоспособный доход.', resultMsgLow: '&#x1F4C8; Отличная отправная точка с солидным потенциалом для роста.', seeCalculationLink: 'Посмотреть расчеты', applyNowButton: 'ПОДАТЬ ЗАЯВКУ', shareButton: 'Поделиться расчетом', newCalculationButton: 'Начать новый расчет', applyTitle: 'Подать заявку', applySubtitle: 'Остался один шаг! Заполните ваши данные.', fullNamePlaceholder: 'Полное имя', phonePlaceholder: 'Номер телефона', emailPlaceholder: 'Электронная почта', submitApplicationButton: 'Отправить заявку', thanksTitle: 'Спасибо!', thanksSubtitle: 'Ваша заявка отправлена. Мы скоро с вами свяжемся.', startOverButton: 'Начать сначала', breakdownTitle: 'Детализация Расчета', copyright: '&copy; 2025 Ray Star LLC. Все права защищены.', contactUs: 'Свяжитесь с нами', companyDriverTitle: 'Зарплата водителя компании',
                progressStep1: 'Тип водителя', progressStep2: 'Мили в неделю', progressStep3: 'Ваши результаты',
                calcGrossIncome: '1. Валовый доход', calcMilesDriven: '{miles} миль', calcPerMile: '× ${rate}/милю', calcExpenses: '2. Предполагаемые расходы', calcFixedCosts: 'Фиксированные расходы:', calcVariableCosts: 'Переменные расходы (на {miles} миль):', calcTotalExpenses: 'Итого предполагаемых расходов', calcTakeHome: '3. Потенциальный доход', calcIncome: 'Доход', calcMinusExpenses: 'Расходы'
            },
            uz: {
                promoTitle: 'Biz bilan haftasiga $6000 gacha ishlang!', appTitle: 'Haydovchi Ish Haqini Hisoblash', progressText: 'Qadam {step}/3: {page}', promoSubtitle: 'Potentsial daromadingizni quyida bilib oling.', question1Title: 'Siz qanday turdagi haydovchisiz?', leaseButton: 'Ijara Operator', companyButton: 'Kompaniya Haydovchisi', ownerButton: 'Mulkor Operator', question2Title: 'Haftasiga necha mil haydaysiz?', milesPlaceholder: 'masalan, 2500', calculateButton: 'Hisoblash', resultTitle: 'Sizning Potentsial Daromadingiz', resultMsgHigh: '&#127942; Ajoyib natija! Siz eng yuqori daromad oluvchilar qatoridasiz.', resultMsgMid: '&#x2728; Ajoyib natija! Bu kuchli, raqobatbardosh daromad.', resultMsgLow: '&#x1F4C8; O\'sish uchun yaxshi potentsialga ega ajoyib boshlanish.', seeCalculationLink: 'Qanday hisoblaganimizni ko\'ring', applyNowButton: 'HOZIR MUROJAAT QILING', shareButton: 'Hisob-kitobni Ulashish', newCalculationButton: 'Yangi Hisob-kitob', applyTitle: 'Murojaat Qiling', applySubtitle: 'Bir qadam qoldi! Ma\'lumotlaringizni to\'ldiring.', fullNamePlaceholder: 'To\'liq ism', phonePlaceholder: 'Telefon raqami', emailPlaceholder: 'Elektron pochta', submitApplicationButton: 'Arizani Yuborish', thanksTitle: 'Rahmat!', thanksSubtitle: 'Arizangiz yuborildi. Tez orada siz bilan bog\'lanamiz.', startOverButton: 'Boshidan Boshlash', breakdownTitle: 'Hisob-kitob Tafsilotlari', copyright: '&copy; 2025 Ray Star LLC. Barcha huquqlar himoyalangan.', contactUs: 'Biz bilan bog\'laning', companyDriverTitle: 'Kompaniya haydovchisining ish haqi',
                progressStep1: 'Haydovchi Turi', progressStep2: 'Haftalik Milya', progressStep3: 'Sizning Natijalaringiz',
                calcGrossIncome: '1. Yalpi daromad', calcMilesDriven: '{miles} mil', calcPerMile: '× ${rate}/mil uchun', calcExpenses: '2. Taxminiy xarajatlar', calcFixedCosts: 'Doimiy xarajatlar:', calcVariableCosts: 'O\'zgaruvchan xarajatlar ({miles} mil uchun):', calcTotalExpenses: 'Jami taxminiy xarajatlar', calcTakeHome: '3. Potentsial daromad', calcIncome: 'Daromad', calcMinusExpenses: 'Xarajatlar'
            }
        };
        
        const state = { driverType: null, miles: 0, takeHomePay: 0, lang: 'en' };
        
        const languageToggleBtn = document.getElementById('language-toggle-btn');
        const languageDropdown = document.getElementById('language-dropdown');
        const backArrow = document.getElementById('back-arrow');
        
        function setLanguage(lang) {
            languageDropdown.classList.add('hidden');
            if (!translations[lang]) return;
            state.lang = lang;
            
            ['en', 'es', 'ru', 'uz'].forEach(id => {
                document.getElementById(`lang-${id}`).classList.toggle('active', id === lang);
            });

            document.querySelectorAll('[data-key]').forEach(el => {
                const key = el.getAttribute('data-key');
                if (translations[lang] && translations[lang][key]) el.innerHTML = translations[lang][key];
            });

            const milesInput = document.getElementById('miles-input');
            if(milesInput) milesInput.placeholder = translations[lang].milesPlaceholder || 'e.g., 2500';
            
            const formInputs = {'fullName': 'fullNamePlaceholder', 'phone': 'phonePlaceholder', 'email': 'emailPlaceholder'};
            Object.keys(formInputs).forEach(inputName => {
                const inputEl = document.querySelector(`input[name="${inputName}"]`);
                if(inputEl) inputEl.placeholder = translations[lang][formInputs[inputName]];
            });

            if (state.driverType) calculateResult();
            
            const currentView = document.querySelector('.view:not(.hidden)');
            if (currentView) showView(currentView.id);
        }

        function showView(viewId) {
            document.querySelectorAll('.view').forEach(v => v.classList.add('hidden'));
            document.getElementById(viewId).classList.remove('hidden');

            const backMap = {
                'view-question2': 'view-question1', 'view-result': 'view-question2', 'view-apply': 'view-result', 'view-calculation': 'view-result'
            };
            backArrow.classList.toggle('hidden', !backMap[viewId]);
            if (backMap[viewId]) backArrow.onclick = () => showView(backMap[viewId]);

            const progressConfig = {
                'view-question1': { step: 1, pageKey: 'progressStep1', width: '33%' },
                'view-question2': { step: 2, pageKey: 'progressStep2', width: '66%' },
                'view-result': { step: 3, pageKey: 'progressStep3', width: '100%' }
            };
            const config = progressConfig[viewId];
            document.getElementById('progress-container').style.visibility = config ? 'visible' : 'hidden';
            if (config) {
                document.getElementById('progress-bar').style.width = config.width;
                const T = translations[state.lang] || translations.en;
                const pageText = T[config.pageKey] || '';
                document.getElementById('progress-text').innerHTML = T.progressText.replace('{step}', config.step).replace('{page}', pageText);
            }
        }

        function selectDriverType(type) {
            state.driverType = type;
            showView('view-question2');
        }

        function submitMiles() {
            const miles = parseInt(document.getElementById('miles-input').value, 10);
            if (isNaN(miles) || miles <= 0) return alert('Please enter a valid number of miles.');
            state.miles = miles;
            trackClickEvent(`Calculated Miles: ${miles}`);
            calculateResult();
            showView('view-result');
            confetti({ particleCount: 150, spread: 90, origin: { y: 0.6 } });
        }

        function calculateResult() {
            let result = 0;
            switch(state.driverType) {
                case 'lease': result = (state.miles * 2.15) * 0.85 - 900 - (0.12 * state.miles) - 375 - (state.miles * 0.45) - 75 - 37 - 250; break;
                case 'company': result = state.miles * 0.65; break;
                case 'owner': result = (state.miles * 2.15) * 0.88 - 375 - (state.miles * 0.45) - 75 - 37 - 250; break;
            }
            state.takeHomePay = result > 0 ? result : 0;
            document.getElementById('result-amount').textContent = state.takeHomePay.toLocaleString('en-US', { style: 'currency', currency: 'USD' });
            
            const msgEl = document.getElementById('result-message');
            const T = translations[state.lang] || translations.en;
            if (result > 2800) msgEl.innerHTML = T.resultMsgHigh;
            else if (result >= 1800) msgEl.innerHTML = T.resultMsgMid;
            else msgEl.innerHTML = T.resultMsgLow;
        }

        function getCalculationText() {
            const T = translations[state.lang] || translations.en;
            const toCurr = (num) => num.toLocaleString('en-US', { style: 'currency', currency: 'USD' });
            let html = '';
            
            if (state.driverType === 'company') {
                const gross = state.miles * 0.65;
                html += `<div class="p-3 bg-gray-100 rounded-lg"><h3 class="font-bold">${T.companyDriverTitle}</h3><p class="flex justify-between"><span>${T.calcMilesDriven.replace('{miles}', state.miles)} ${T.calcPerMile.replace('{rate}', '0.65')}</span><strong>${toCurr(gross)}</strong></p></div>`;
                return html;
            }
            
            const grossIncome = state.miles * 2.15;
            let fixedCosts = [{l:'Cargo & Liability Insurance',v:375},{l:'Trailer Charge',v:250},{l:'Admin Fee',v:75},{l:'Occupational Insurance',v:37}];
            let varCosts = [{l:`Fuel Expense ($0.45/mile)`,v:state.miles*0.45}];

            if (state.driverType === 'lease') {
                fixedCosts.unshift({l:'Truck Charge',v:900});
                varCosts.unshift({l:`Service Charge (15%)`,v:grossIncome*0.15});
                varCosts.push({l:`Mileage Charge ($0.12/mile)`,v:state.miles*0.12});
            } else { // Owner
                varCosts.unshift({l:`Service Charge (12%)`,v:grossIncome*0.12});
            }

            const totalFixed = fixedCosts.reduce((sum, item) => sum + item.v, 0);
            const totalVar = varCosts.reduce((sum, item) => sum + item.v, 0);
            const totalExpenses = totalFixed + totalVar;
            const takeHome = grossIncome - totalExpenses;

            html += `<div class="p-3 bg-green-50 border border-green-200 rounded-lg"><h3 class="font-bold text-green-800">${T.calcGrossIncome}</h3><p class="flex justify-between"><span>${T.calcMilesDriven.replace('{miles}', state.miles)} ${T.calcPerMile.replace('{rate}', '2.15')}</span><strong>${toCurr(grossIncome)}</strong></p></div>`;
            html += `<div class="p-3 bg-red-50 border border-red-200 rounded-lg"><h3 class="font-bold text-red-800">${T.calcExpenses}</h3><div class="font-semibold mt-2">${T.calcFixedCosts}</div>`;
            fixedCosts.forEach(i => { html += `<p class="flex justify-between"><span>${i.l}</span><span>${toCurr(i.v)}</span></p>` });
            html += `<div class="font-semibold mt-2">${T.calcVariableCosts.replace('{miles}', state.miles)}</div>`;
            varCosts.forEach(i => { html += `<p class="flex justify-between"><span>${i.l}</span><span>${toCurr(i.v)}</span></p>` });
            html += `<p class="flex justify-between font-bold mt-2 border-t pt-1 border-gray-300"><span>${T.calcTotalExpenses}</span><span>${toCurr(totalExpenses)}</span></p></div>`;
            html += `<div class="p-3 bg-blue-50 border border-blue-200 rounded-lg"><h3 class="font-bold text-blue-800">${T.calcTakeHome}</h3><p class="flex justify-between"><span>${toCurr(grossIncome)} (${T.calcIncome}) - ${toCurr(totalExpenses)} (${T.calcMinusExpenses})</span><strong class="text-lg">${toCurr(takeHome)}</strong></p></div>`;
            
            return html;
        }

        function showCalculation() {
            document.getElementById('calculation-details').innerHTML = getCalculationText();
            showView('view-calculation');
        }
        
        async function shareResult() {
            const url = new URL(window.location.href);
            url.search = `?type=${state.driverType}&miles=${state.miles}&result=${state.takeHomePay.toFixed(2)}&lang=${state.lang}`;
            const shareData = {
                title: 'My Potential Earnings at Ray Star LLC',
                text: `Check out my potential weekly take-home pay of ${state.takeHomePay.toLocaleString('en-US', { style: 'currency', currency: 'USD' })} with Ray Star LLC!`,
                url: url.toString()
            };
            if (navigator.share) {
                try { await navigator.share(shareData); } catch (err) { console.error("Share failed:", err); }
            } else {
                navigator.clipboard.writeText(url.toString());
                alert('A shareable link has been copied to your clipboard!');
            }
        }

        function restart() {
            state.driverType = null;
            state.miles = 0;
            document.getElementById('miles-input').value = '';
            showView('view-question1');
        }

        function trackEvent(action, eventValue) {
            const formData = new FormData();
            formData.append('action', action);
            formData.append('event', eventValue);
            fetch(scriptURL, { method: 'POST', body: formData, mode: 'no-cors' }).catch(console.error);
        }
        
        function trackClickEvent(eventName) { trackEvent('clickEvent', eventName); }
        
        document.addEventListener('DOMContentLoaded', () => {
            const urlParams = new URLSearchParams(window.location.search);
            const type = urlParams.get('type'), miles = urlParams.get('miles'), result = urlParams.get('result'), lang = urlParams.get('lang');
            
            setLanguage(lang || 'en');

            if (type && miles && result) {
                state.driverType = type;
                state.miles = parseInt(miles, 10);
                state.takeHomePay = parseFloat(result);
                document.getElementById('result-amount').textContent = state.takeHomePay.toLocaleString('en-US', { style: 'currency', currency: 'USD' });
                calculateResult();
                showView('view-result');
            } else {
                showView('view-question1');
                trackEvent('pageView', 'Page Loaded');
            }
            
            languageToggleBtn.addEventListener('click', (e) => { e.stopPropagation(); languageDropdown.classList.toggle('hidden'); });
            document.addEventListener('click', () => languageDropdown.classList.add('hidden'));

            const form = document.getElementById('application-form');
            form.addEventListener('submit', (e) => {
                e.preventDefault();
                const submitBtn = document.getElementById('submit-form-button');
                const originalText = submitBtn.innerHTML;
                submitBtn.disabled = true;
                submitBtn.innerHTML = 'Submitting...';

                const formData = new FormData(form);
                formData.append('action', 'formSubmit');
                formData.append('driverType', state.driverType);
                formData.append('miles', state.miles);
                formData.append('potentialPay', state.takeHomePay.toFixed(2));

                fetch(scriptURL, { method: 'POST', body: formData, mode: 'no-cors' })
                    .then(() => showView('view-thanks'))
                    .catch(() => showView('view-thanks')) 
                    .finally(() => {
                        submitBtn.disabled = false;
                        submitBtn.innerHTML = originalText;
                        form.reset();
                    });
            });
        });
    </script>
</body>
</html>

